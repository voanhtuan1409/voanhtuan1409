/***********************************************************************************************************************
Includes library
***********************************************************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

/***********************************************************************************************************************
Define macro
***********************************************************************************************************************/
#define DOUBLE_TO_FIX( X,SCALE) (X * (1<<SCALE))
#define FIX_TO_DOUBLE( X,SCALE) (X / (1<<SCALE))
#define RANGE_INPUT					361
#define SCALE						19

/***********************************************************************************************************************
Private global variables and functions
***********************************************************************************************************************/
typedef long fix_32;
typedef long long fix_64;

const float pi = 3.1415;

static void func_floating_point( int in );
static void func_fixed_point( int in);

//define lookup table for the cos((in*pi)/180)  _coppy the data from the 1st line of math_result.txt 
fix_32 CosVal[RANGE_INPUT] = {524288.000000, 524208.156250, 523968.625000, 523569.531250, 523010.937500, 522293.031250, 521416.062500, 520380.281250, 519185.968750, 517833.531250, 516323.343750, 514655.906250, 512831.718750, 510851.312500, 508715.312500, 506424.375000, 503979.156250, 501380.437500, 498629.031250, 495725.718750, 492671.406250, 489467.031250, 486113.593750, 482612.062500, 478963.562500, 475169.156250, 471230.000000, 467147.343750, 462922.375000, 458556.406250, 454050.781250, 449406.843750, 444626.031250, 439709.750000, 434659.593750, 429477.000000, 424163.625000, 418721.031250, 413150.906250, 407454.937500, 401634.843750, 395692.437500, 389629.500000, 383447.875000, 377149.468750, 370736.187500, 364209.968750, 357572.843750, 350826.781250, 343973.843750, 337016.156250, 329955.812500, 322794.968750, 315535.812500, 308180.531250, 300731.406250, 293190.656250, 285560.625000, 277843.593750, 270041.937500, 262158.031250, 254194.265625, 246153.078125, 238036.921875, 229848.250000, 221589.578125, 213263.406250, 204872.281250, 196418.750000, 187905.406250, 179334.812500, 170709.593750, 162032.375000, 153305.812500, 144532.562500, 135715.265625, 126856.648438, 117959.390625, 109026.195313, 100059.796875, 91062.921875, 82038.304688, 72988.703125, 63916.867188, 54825.566406, 45717.562500, 36595.636719, 27462.562500, 18321.123047, 9174.103516, 24.289583, -9125.531250, -18272.572266, -27414.048828, -36547.175781, -45669.167969, -54777.250000, -63868.652344, -72940.593750, -81990.320313, -91015.078125, -100012.109375, -108978.679688, -117912.054688, -126809.515625, -135668.343750, -144485.859375, -153259.359375, -161986.187500, -170663.656250, -179289.156250, -187860.046875, -196373.718750, -204827.562500, -213219.031250, -221545.546875, -229804.593750, -237993.640625, -246110.187500, -254151.781250, -262115.953125, -270000.281250, -277802.375000, -285519.875000, -293150.375000, -300691.593750, -308141.250000, -315497.031250, -322756.687500, -329918.062500, -336978.937500, -343937.187500, -350790.687500, -357537.312500, -364175.031250, -370701.843750, -377115.718750, -383414.750000, -389597.000000, -395660.562500, -401603.625000, -407424.343750, -413121.000000, -418691.781250, -424135.062500, -429449.125000, -434632.406250, -439683.312500, -444600.281250, -449381.812500, -454026.468750, -458532.843750, -462899.562500, -467125.281250, -471208.718750, -475148.625000, -478943.781250, -482593.093750, -486095.406250, -489449.625000, -492654.781250, -495709.906250, -498614.000000, -501366.250000, -503965.781250, -506411.781250, -508703.562500, -510840.406250, -512821.625000, -514646.656250, -516314.906250, -517825.937500, -519179.187500, -520374.343750, -521411.000000, -522288.812500, -523007.531250, -523566.968750, -523966.937500, -524207.312500, -524288.000000, -524209.000000, -523970.343750, -523572.062500, -523014.312500, -522297.281250, -521421.125000, -520386.187500, -519192.718750, -517841.125000, -516331.781250, -514665.187500, -512841.812500, -510862.250000, -508727.062500, -506436.937500, -503992.562500, -501394.656250, -498644.031250, -495741.531250, -492688.031250, -489484.437500, -486131.781250, -482631.062500, -478983.312500, -475189.687500, -471251.312500, -467169.375000, -462945.187500, -458579.968750, -454075.062500, -449431.843750, -444651.750000, -439736.218750, -434686.750000, -429504.875000, -424192.156250, -418750.250000, -413180.812500, -407485.500000, -401666.062500, -395724.312500, -389662.000000, -383481.000000, -377183.218750, -370770.531250, -364244.906250, -357608.343750, -350862.875000, -344010.531250, -337053.375000, -329993.562500, -322833.250000, -315574.625000, -308219.843750, -300771.187500, -293230.937500, -285601.343750, -277884.781250, -270083.562500, -262200.093750, -254236.750000, -246195.968750, -238080.203125, -229891.921875, -221633.609375, -213307.796875, -204917.000000, -196463.796875, -187950.750000, -179380.453125, -170755.531250, -162078.578125, -153352.265625, -144579.250000, -135762.187500, -126903.781250, -118006.718750, -109073.710938, -100107.484375, -91110.757813, -82086.281250, -73036.804688, -63965.085938, -54873.878906, -45765.957031, -36644.097656, -27511.074219, -18369.671875, -9222.674805, -72.868744, 9076.959961, 18224.023438, 27365.535156, 36498.714844, 45620.773438, 54728.937500, 63820.433594, 72892.492188, 81942.343750, 90967.234375, 99964.421875, 108931.156250, 117864.718750, 126762.375000, 135621.421875, 144439.156250, 153212.906250, 161939.984375, 170617.734375, 179243.515625, 187814.687500, 196328.671875, 204782.843750, 213174.656250, 221501.531250, 229760.921875, 237950.343750, 246067.296875, 254109.281250, 262073.875000, 269958.656250, 277761.187500, 285479.125000, 293110.093750, 300651.812500, 308101.937500, 315458.218750, 322718.406250, 329880.312500, 336941.750000, 343900.531250, 350754.562500, 357501.781250, 364140.093750, 370667.468750, 377081.968750, 383381.625000, 389564.468750, 395628.687500, 401572.375000, 407393.781250, 413091.062500, 418662.531250, 424106.500000, 429421.281250, 434605.250000, 439656.843750, 444574.531250, 449356.781250, 454002.187500, 458509.312500, 462876.750000, 467103.218750, 471187.406250, 475128.093750, 478924.031250, 482574.093750, 486077.187500, 489432.218750, 492638.187500, 495694.062500, 498599.000000, 501352.031250, 503952.375000, 506399.218750, 508691.812500, 510829.468750, 512811.500000, 514637.375000, 516306.468750, 517818.312500, 519172.437500, 520368.406250, 521405.906250, 522284.562500, 523004.156250, 523564.437500, 523965.250000, 524206.437500, 524288.000000 };
//define lookup table for the sqrt(in) _coppy the data from the 3rd line of math_result.txt 
fix_32 SQRTVal[RANGE_INPUT] = {0.000000, 524288.000000, 741455.187500, 908093.437500, 1048576.000000, 1172343.625000, 1284238.125000, 1387135.625000, 1482910.375000, 1572864.000000, 1657944.250000, 1738866.625000, 1816186.875000, 1890347.250000, 1961706.125000, 2030558.750000, 2097152.000000, 2161694.750000, 2224365.500000, 2285318.500000, 2344687.250000, 2402589.500000, 2459128.750000, 2514397.000000, 2568476.250000, 2621440.000000, 2673354.750000, 2724280.250000, 2774271.250000, 2823377.250000, 2871643.750000, 2919112.000000, 2965820.750000, 3011805.250000, 3057098.000000, 3101729.750000, 3145728.000000, 3189119.500000, 3231928.250000, 3274177.500000, 3315888.500000, 3357081.250000, 3397774.500000, 3437986.250000, 3477733.250000, 3517030.750000, 3555894.250000, 3594337.500000, 3632373.750000, 3670016.000000, 3707276.000000, 3744165.250000, 3780694.500000, 3816874.250000, 3852714.250000, 3888223.750000, 3923412.250000, 3958287.500000, 3992858.500000, 4027132.500000, 4061117.500000, 4094820.250000, 4128247.750000, 4161407.000000, 4194304.000000, 4226945.000000, 4259336.000000, 4291482.000000, 4323389.500000, 4355063.000000, 4386508.000000, 4417729.000000, 4448731.000000, 4479518.500000, 4510096.000000, 4540467.500000, 4570637.000000, 4600608.500000, 4630386.000000, 4659973.500000, 4689374.500000, 4718592.000000, 4747630.000000, 4776491.000000, 4805179.000000, 4833696.500000, 4862047.000000, 4890233.000000, 4918257.500000, 4946123.000000, 4973832.500000, 5001389.000000, 5028794.000000, 5056050.500000, 5083161.000000, 5110127.500000, 5136952.500000, 5163638.000000, 5190186.500000, 5216599.500000, 5242880.000000, 5269029.000000, 5295049.000000, 5320942.000000, 5346709.500000, 5372353.500000, 5397875.500000, 5423277.000000, 5448560.500000, 5473727.500000, 5498779.000000, 5523717.000000, 5548542.500000, 5573258.000000, 5597864.000000, 5622362.500000, 5646754.500000, 5671042.000000, 5695225.500000, 5719307.000000, 5743287.500000, 5767168.000000, 5790950.000000, 5814635.000000, 5838224.000000, 5861718.000000, 5885118.000000, 5908425.500000, 5931641.500000, 5954767.000000, 5977803.000000, 6000750.500000, 6023610.500000, 6046384.000000, 6069072.500000, 6091676.000000, 6114196.000000, 6136633.500000, 6158989.500000, 6181264.500000, 6203459.500000, 6225575.000000, 6247612.500000, 6269572.500000, 6291456.000000, 6313263.500000, 6334996.000000, 6356654.000000, 6378239.000000, 6399750.500000, 6421190.500000, 6442559.000000, 6463856.500000, 6485084.500000, 6506243.000000, 6527333.000000, 6548355.000000, 6569310.000000, 6590198.000000, 6611020.000000, 6631777.000000, 6652469.000000, 6673097.000000, 6693661.000000, 6714162.500000, 6734601.500000, 6754978.500000, 6775294.000000, 6795549.000000, 6815744.000000, 6835879.000000, 6855955.000000, 6875972.500000, 6895932.000000, 6915833.500000, 6935678.500000, 6955466.500000, 6975198.000000, 6994874.500000, 7014495.500000, 7034061.500000, 7053573.500000, 7073032.000000, 7092436.500000, 7111788.500000, 7131088.000000, 7150335.000000, 7169530.500000, 7188675.000000, 7207768.500000, 7226811.500000, 7245804.500000, 7264747.500000, 7283641.500000, 7302487.000000, 7321283.500000, 7340032.000000, 7358732.500000, 7377386.000000, 7395992.500000, 7414552.000000, 7433065.500000, 7451532.500000, 7469954.000000, 7488330.500000, 7506662.000000, 7524948.500000, 7543191.000000, 7561389.000000, 7579543.500000, 7597655.000000, 7615723.000000, 7633748.500000, 7651731.500000, 7669672.000000, 7687571.000000, 7705428.500000, 7723244.500000, 7741019.500000, 7758754.000000, 7776447.500000, 7794101.500000, 7811715.500000, 7829289.500000, 7846824.500000, 7864320.000000, 7881777.000000, 7899195.000000, 7916575.000000, 7933917.000000, 7951221.000000, 7968487.500000, 7985717.000000, 8002909.000000, 8020064.000000, 8037183.000000, 8054265.000000, 8071311.000000, 8088321.500000, 8105296.000000, 8122235.000000, 8139138.500000, 8156007.000000, 8172841.000000, 8189640.500000, 8206405.500000, 8223136.000000, 8239832.500000, 8256495.500000, 8273125.000000, 8289721.000000, 8306284.000000, 8322814.000000, 8339311.000000, 8355775.500000, 8372208.000000, 8388608.000000, 8404976.000000, 8421312.000000, 8437617.000000, 8453890.000000, 8470132.000000, 8486343.000000, 8502523.000000, 8518672.000000, 8534790.000000, 8550879.000000, 8566937.000000, 8582964.000000, 8598963.000000, 8614931.000000, 8630870.000000, 8646779.000000, 8662659.000000, 8678511.000000, 8694333.000000, 8710126.000000, 8725891.000000, 8741628.000000, 8757336.000000, 8773016.000000, 8788668.000000, 8804293.000000, 8819889.000000, 8835458.000000, 8851000.000000, 8866515.000000, 8882002.000000, 8897462.000000, 8912896.000000, 8928303.000000, 8943683.000000, 8959037.000000, 8974365.000000, 8989667.000000, 9004942.000000, 9020192.000000, 9035416.000000, 9050614.000000, 9065787.000000, 9080935.000000, 9096057.000000, 9111154.000000, 9126226.000000, 9141274.000000, 9156296.000000, 9171294.000000, 9186268.000000, 9201217.000000, 9216142.000000, 9231043.000000, 9245920.000000, 9260772.000000, 9275602.000000, 9290407.000000, 9305189.000000, 9319947.000000, 9334682.000000, 9349394.000000, 9364083.000000, 9378749.000000, 9393392.000000, 9408012.000000, 9422609.000000, 9437184.000000, 9451736.000000, 9466266.000000, 9480774.000000, 9495260.000000, 9509723.000000, 9524164.000000, 9538584.000000, 9552982.000000, 9567358.000000, 9581713.000000, 9596046.000000, 9610358.000000, 9624648.000000, 9638918.000000, 9653166.000000, 9667393.000000, 9681599.000000, 9695785.000000, 9709950.000000, 9724094.000000, 9738217.000000, 9752321.000000, 9766403.000000, 9780466.000000, 9794508.000000, 9808530.000000, 9822533.000000, 9836515.000000, 9850477.000000, 9864420.000000, 9878343.000000, 9892246.000000, 9906130.000000, 9919994.000000, 9933840.000000, 9947665.000000};

fix_64 fix_mul(fix_32 x, fix_32 y);
fix_32 fix_64_to_32(fix_64 x);

/***********************************************************************************************************************
* Function Name: main
* Description  : This function implements main function.
* Arguments    : None
* Return Value : None
***********************************************************************************************************************/
void main( void )
{
	int in = 0;
	// Get in
	while(1){
		printf( "\nInput a number from 0 - 360:\n" );
		scanf( "%d", &in );
		if( ( in < 0 ) || ( in > 360 ) ){
			exit(0);
		}
		func_floating_point(in);
		func_fixed_point(in);
	}
}

/***********************************************************************************************************************
* Function Name: func_floating_point
* Description  : perform floating point calculation
* Arguments    : int in 
* Return Value : None
***********************************************************************************************************************/
void func_floating_point(int in )
{
    const float A[5] = { 1.5, 3.5, 5.5, 7.5, 9.5 };
    int out1, out2, out3;
	float temp;
	   
    // Calculate out1
    temp = cos((in*pi)/180) + sqrt((float)(in));
    out1 = (int)temp;
	printf( "\nFloating point:\n" );
    printf( "out1 = %d\n", out1 );

    // Calculate out2
    temp *= temp;
    out2 = (int)temp;
    printf( "out2 = %d\n", out2 );

    // Calculate out3
    if( temp < 2.0 ){
        temp *= A[0];
    }
    else if( temp < 4.0 ){
        temp *= A[1];
    }
    else if( temp < 6.0 ){
        temp *= A[2];
    }
    else if( temp < 8.0 ){
        temp *= A[3];
    }
    else{
        temp *= A[4];
    }
    temp += in;
    out3 = (int)temp;
    printf( "out3 = %d\n", out3 );
}

/***********************************************************************************************************************
* Function Name: func_fixed_point(int in )
* Description  : perform fixed point calculation
* Arguments    : int in
* Return Value : None
***********************************************************************************************************************/
void func_fixed_point(int in )
{
	const fix_32 A[5] = { DOUBLE_TO_FIX(1.5,SCALE), DOUBLE_TO_FIX(3.5,SCALE), DOUBLE_TO_FIX(5.5,SCALE), DOUBLE_TO_FIX(7.5,SCALE), DOUBLE_TO_FIX(9.5,SCALE) };
    int out1, out2, out3;

   	fix_32 temp;		//S.12.19
	fix_64 temp64; 
    
    // Calculate out1
    temp = CosVal[in] + SQRTVal[in];
    out1 = (int)(FIX_TO_DOUBLE((temp),SCALE));
	printf( "\nFixed point:\n" );
    printf( "out1 = %d\n", out1 );

    // Calculate out2
	temp64 = fix_mul(temp,temp);	//S.(32-SCALE-1)*2.(SCALE*2+1)
   	temp = fix_64_to_32(temp64);	// S.(32-SCALE).(SCALE)
	out2 = (int)(FIX_TO_DOUBLE(temp,SCALE));
    printf( "out2 = %d\n", out2 );

    // Calculate out3
	if( temp < DOUBLE_TO_FIX(2.0,SCALE) ){
        temp64 = fix_mul(temp,A[0]);	//S.(32-SCALE-1)*2.(SCALE*2+1)
    }
    else if( temp < DOUBLE_TO_FIX(4.0,SCALE) ){
        temp64 = fix_mul(temp,A[1]);
    }
    else if( temp < DOUBLE_TO_FIX(6.0,SCALE)){
        temp64 = fix_mul(temp,A[2]);
    }
    else if( temp < DOUBLE_TO_FIX(8.0,SCALE) ){
        temp64 = fix_mul(temp,A[3]);
    }
    else{
        temp64 = fix_mul(temp,A[4]);
    }
    temp = fix_64_to_32(temp64);	// S.(32-SCALE).(SCALE)
    out3 =  (int)(FIX_TO_DOUBLE(temp,SCALE) + in);
    printf( "out3 = %d\n", out3 );
}

/***********************************************************************************************************************
* Function Name: fix_64 fix_mul(fix_32 x, fix_32 y)
* Description  : multifly 2 fixed pont vavarible
* Arguments    : fix_32 x, fix_32 y
* Return Value : fix_64 fix_mul
***********************************************************************************************************************/
fix_64 fix_mul(fix_32 x, fix_32 y){				//parameter x,y mode is S.(32-SCALE).(SCALE) 
	fix_64 result;
	result = ((fix_64)(x) * (fix_64)(y)) << 1 ;	//S.(32-SCALE-1)*2.(SCALE*2+1)
	return result;
}

/***********************************************************************************************************************
* Function Name: fix_32 fix_64_to_32(fix_64 x)
* Description  : rescale the 64 bit fix point data (after multiply) to normal 32 bit fix point data
* Arguments    : fix_64 x
* Return Value : fix_32 fix_64_to_32
***********************************************************************************************************************/
fix_32 fix_64_to_32(fix_64 x){
	fix_32 result;
	result = (fix_32)(x >> 32);			//cut 32 bit of right -->result will be S.(32-SCALE-1)*2.(SCALE*2+1-32)
	result = result << (32-1-SCALE);	//shift left to back to S.(32-SCALE).(SCALE) --> shift value is (32-1-SCALE)
	return result;
}

